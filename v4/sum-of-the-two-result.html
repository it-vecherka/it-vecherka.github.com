<!DOCTYPE html>
<html>
<head>
  <title>Сумма двух - разбор полётов - Олимпиада - Вечерний Анахорет™</title>

  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
<meta http-equiv="Content-Language" content="en" />
<meta http-equiv="imagetoolbar" content="no" />

<meta name="viewport" content="width = device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable = no" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<link rel="apple-touch-startup-image" href="/startup.png" />
<meta name="HandheldFriendly" content="True" />
<meta http-equiv="cleartype" content="on" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Page-Exit" content="progid:DXImageTransform.Microsoft.Fade(Duration=0.2)" />
<meta name="viewport" content="width=device-width,initial-scale=1" />

<meta name="robots" content="all" />

<link rel="copyright" href="" />
<link rel="author" href="" />


  <link rel="shortcut icon" href="/favicon.ico" />
<link rel="icon" type="image/png" href="/favicon.png" />
<link rel="icon" type="image/x-icon" href="/android-favicon.ico"  />
<link rel="apple-touch-icon" href="/apple-touch-icon-iphone.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/apple-touch-icon-ipad.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/apple-touch-icon-iphone4.png" />



  <!--[if IE]>
  <script type="text/javascript">
    //<![CDATA[
    document.createElement('header');
    document.createElement('nav');
    document.createElement('section');
    document.createElement('article');
    document.createElement('author');
    document.createElement('aside');
    document.createElement('footer');
  //]]>
  </script>
<![endif]-->
<style type="text/css">
  header, nav, section, article, aside, footer {
    display: block;
  }
</style>


  <link href="/v4/application.css" media="screen" rel="stylesheet" type="text/css" />
  <meta content="authenticity_token" name="csrf-param" />
<meta content="qlV878vjorhJ0W+GYBwB2QrAchJ/il6JHlq8RCmI2yc=" name="csrf-token" />


</head>
<body>
<div id="container">
  <header>
    <div class="wrapper">
      <a href="/"><img alt="Вечерний Анахорет™" src="/v4/logo.ru.png" title="Вечерний Анахорет™" /></a>
      <small class="issue">Четвертый выпуск</small>

    </div>
  </header>



  <section id="main" role="main">
    <div class="wrapper">
      <div class="author">@Dmitriy Kiriyenko</div>

<h1>Сумма двух - разбор полётов</h1>

<div>
  <p>Некоторое время назад общественности была предложена <a href="http://vecherka.cssum.net/v4/warm-up-sum-of-two.html">очередная разминка</a>, в которой предлагалось в массиве найти пару чисел, формирующих целевую сумму, или убедиться, что их нет. Ну, точнее, нужно было просто проверить, есть ли такие числа.</p>

<p>Последовавшая за этим дискуссия и всплеск решений были довольно интересны.</p>

<p>Первым обнаружился Артём Цаплин. <a href="https://gist.github.com/2948116">Его решение</a> - бинарный поиск с двух концов в упорядоченном массиве. Решение хорошее, но сортировку Артём применил свою, причём, это была сортировка вставкой, что тут же вывело его решение на квадратичную сложность.</p>

<p>Вторым в задаче отметился <a href="https://twitter.com/zocheg">Иван Трусов</a>, и отметился превосходно. Его решение во-первых, на чистом bash, а во-вторых довольно красивое. Он сортирует массив по хитрому критерию - так, чтобы числа, предположительно формирующие сумму, оказались рядом. Он перевёл своё решение на понятный нам руби - <a href="http://pastebin.com/SaBerWFF">прочитайте, не пожалеете</a>. Сложность очевидно равна сложности библиотечной сортировки - для быстрой сортировки это квадрат, но сбалансированная сложность N*log(N).</p>

<p>Два решения <a href="https://twitter.com/rbolgov">Романа Болгова</a> на javascript продолжают триумфальное разбирательство сообщества с задачей. <a href="https://gist.github.com/2950146">Первое</a> - использование хитрой структуры данных, известной как <a href="http://ru.wikipedia.org/wiki/%D0%91%D0%B8%D0%BD%D0%B0%D1%80%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE">двоичное дерево поиска</a>. <a href="https://gist.github.com/2950651">Второе</a> - использование хэш-таблицы для поиска пар чисел. Решение с хэш-таблицей - первое, которое имеет линейную сбалансированную сложность (в худшем случае мешают унизительные подробности реализации хэш-таблиц). Подробнее о хэш-таблицах, почему их применение, на мой взгляд, легитимно в этой задаче, и почему они всё же в худшем случае не дают нам O(N), можно прочитать в кратком обзоре <a href="http://vecherka.cssum.net/v4/inside-the-hash.html">Хеши: в поисках правды</a>. Решения весьма шустрые, в чём я подозреваю собственно, nodejs.</p>

<p>Далее в задаче обнаружился <a href="http://twitter.com/dudarev">Артём Дударев</a> с <a href="https://gist.github.com/b5fb033de085623d38fb">решением на python</a>, использующем hash set. Решение, надо сказать, самое шустрое из предложенных. Заслуга в этом очень быстрых питоновских хэшей (которые по скорости заметно обгоняют рубишные, впрочем, настолько же уступая им по использованию памяти.</p>

<p><a href="http://about.me/levzhinsky">Алексей Левжинский</a> тоже предложил два абсолютно идентичных решения - с хэшом и с разреженным массивом в качестве структуры данных. Здесь интересно то, что массив действительно единственная структура данных с честным константным произвольным доступом. В Ruby 2.0 хэши до 20 элементов будут внутри представлены массивом. Конечно, в решении Алексея совершенно сумашедший оверхед по памяти, но алгоритмически он прав. </p>

<p>Два решения от Владимира Львовича - сортировка и бинарный поиск второго слагаемого, и укладка в хэш и поиск по хэш-таблице второго слагаемого - завершили парад предложенных решений.</p>

<p>Замеры производительности:</p>

<pre><code>                        100000
================================
ruby tsaplin.rb          2.058
./trusov-coolsort.sh     0.359
ruby trusov_coolsort.rb  0.360
./trusov-hash.rb         0.330
node bolgovr_hash.js     0.322
node bolgovr_tree.js     0.343
python dudarev.py        0.232
ruby jinnsky_hash.rb     0.292
ruby jinnsky_array_rb    0.260
ruby raven29_binary.rb   0.459
ruby raven29_hash.rb     0.344
</code></pre>

<p>За неимением времени производительность измерялась так: на том же тестовом файле прогнал по 100 раз с разными искомыми числами и в результат пошли худшие случаи.</p>

<p>Номинации:</p>

<ul>
<li><em>Скор на ответ</em> - Артём Цаплин.</li>
<li><em>Самое быстрое решение</em> - Артём Дударев.</li>
<li><em>Порадовал</em> - Иван Борисович Трусов - за bash.</li>
<li><em>Почему бы и нет?</em> - Роман Болгов - за дерево.</li>
<li><em>Молодым везде у нас дорога</em> - Алексей Левжинский. Его решение на руби алгоритмически такое же, как и у всех, но заметно быстрее многих.</li>
<li><em>Тиграм не докладывают мяса</em> - Андрей Кутейко. За дискуссию про хэши.</li>
<li><em>Давайте сделаем это правильно</em> - Владимир Львович Коварский. За самотестирующийся скрипт. Дима и Андрей прошлый раз все свои решения сопровождали встроенными тестами, но послание воспринял только Владимир Львович.</li>
</ul>

<p>Несколько выводов:</p>

<ul>
<li>Разминки - замечательная штука. Перед публикацией было найдено только два из предложенных решений и сообщество нашло еще три других.</li>
<li>Уже к середине недели задача была порвана в клочья и мы рассуждали о тонкостях использования структур данных.</li>
<li>Язык реализиции слабо влияет на проиводительность. Никакие микрооптимизации не сделают сортировку вставкой быстрее поиска по хэш-таблице, а решения одинаковые концептуально, будут очень близки по скорости работы.</li>
<li>Очень много нового можно узнать, копнув где угодно. Час внутри реализации рубишных хэшей <a href="http://vecherka.cssum.net/v4/inside-the-hash.html">дали ответы</a> на множество незаданных вопросов.</li>
<li>Bash - довольно лаконичный язык программирования. Элегантные однострочники от Ивана Трусова и компактны и читаемы.</li>
</ul>

<p>Спасибо всем кто участвовал.</p>

</div>

<div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'vecherka';
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>






    </div>
  </section>

  <span id="empty_footer"></span>
  <footer>
    <div class="wrapper">
      <a href="https://twitter.com/it_vecherka" class="twitter-follow-button" data-show-count="false" data-lang="ru" data-show-screen-name="false">Читать @it_vecherka</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>

      <div class="copyright"><div>&copy;&nbsp;<strong>Вечерний Анахорет&trade;</strong></div>
<div><small>Все права защищены кольчугой из&nbsp;чешуи дракона +3</small></div>
<div><small>Предложения и&nbsp;замечания <a href="mailto:aratak@anahoret.com">шлите редактору</a>.</small></div>

</div>

    </div>
  </footer>
</div>
<!-- Yandex.Metrika counter -->
<div style="display:none;"><script type="text/javascript">
(function(w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter10762477 = new Ya.Metrika({id:10762477, enableAll: true});
        }
        catch(e) { }
    });
})(window, "yandex_metrika_callbacks");
</script></div>
<script src="//mc.yandex.ru/metrika/watch.js" type="text/javascript" defer="defer"></script>
<noscript><div><img src="//mc.yandex.ru/watch/10762477" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->

</body>
</html>
